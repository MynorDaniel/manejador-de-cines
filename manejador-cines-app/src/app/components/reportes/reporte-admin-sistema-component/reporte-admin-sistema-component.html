<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      
      @if(errorMsg) {
        <div class="alert alert-danger" role="alert">
          <i class="bi bi-exclamation-triangle"></i> {{errorMsg}}
        </div>
      }

      @if(infoMsg) {
        <div class="alert alert-success" role="alert">
          <i class="bi bi-check-circle"></i> {{infoMsg}}
        </div>
      }

      <div class="card shadow-lg">
        <div class="card-header bg-success text-white">
          <h3 class="mb-0">
            <i class="bi bi-cash-coin"></i> Reporte de Ganancias del Sistema
          </h3>
        </div>
        <div class="card-body p-4">
          
          <form [formGroup]="filtrosForm" (ngSubmit)="generarReporte()">
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="fechaInicio" class="form-label">
                  <i class="bi bi-calendar-event"></i> Fecha de Inicio
                </label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="fechaInicio" 
                  formControlName="fechaInicio"
                >
              </div>

              <div class="col-md-6 mb-3">
                <label for="fechaFin" class="form-label">
                  <i class="bi bi-calendar-event"></i> Fecha de Fin
                </label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="fechaFin" 
                  formControlName="fechaFin"
                >
              </div>
            </div>

            <hr>

            <div class="d-flex gap-2 justify-content-end">
              <button 
                type="button" 
                class="btn btn-secondary"
                (click)="limpiarFormulario()"
                [disabled]="cargando"
              >
                <i class="bi bi-x-circle"></i> Limpiar
              </button>
              <button 
                type="button" 
                class="btn btn-danger"
                (click)="generarReportePDF()"
              >
                <i class="bi bi-file-pdf"></i> PDF
              </button>
              <button 
                type="submit" 
                class="btn btn-success"
                [disabled]="cargando"
              >
                @if(cargando) {
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  Generando...
                } @else {
                  <i class="bi bi-file-earmark-text"></i> Generar Reporte
                }
              </button>
            </div>

          </form>

        </div>
      </div>

      @if(reporteGanancias) {
        <div class="mt-4">
          
          <div class="card shadow mb-4">
            <div class="card-header bg-dark text-white">
              <h4 class="mb-0">
                <i class="bi bi-graph-up"></i> Resumen
              </h4>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-4">
                  <div class="p-3 border rounded bg-danger bg-opacity-10">
                    <h5 class="text-danger">Costos</h5>
                    <h2 class="mb-0">${{ reporteGanancias.costo }}</h2>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="p-3 border rounded bg-primary bg-opacity-10">
                    <h5 class="text-primary">Ingresos</h5>
                    <h2 class="mb-0">${{ reporteGanancias.ingreso }}</h2>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="p-3 border rounded bg-success bg-opacity-10">
                    <h5 class="text-success">Ganancias</h5>
                    <h2 class="mb-0">${{ reporteGanancias.ganancia }}</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Cines -->
          @if(reporteGanancias.cines && reporteGanancias.cines.length > 0) {
            <div class="card shadow mb-4">
              <div class="card-header bg-info text-white">
                <h4 class="mb-0">
                  <i class="bi bi-building"></i> Costo diario a cines
                </h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Monto Adeudado</th>
                        <th>Monto Pagado</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for(cine of reporteGanancias.cines; track cine.idCine) {
                        <tr>
                          <td>{{ cine.idCine }}</td>
                          <td>{{ cine.nombre }}</td>
                          <td class="text-danger">${{ cine.montoAdeudado }}</td>
                          <td class="text-success">${{ cine.montoPagado }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }

          <!-- Anuncios -->
          @if(reporteGanancias.anuncios && reporteGanancias.anuncios.length > 0) {
            <div class="card shadow mb-4">
              <div class="card-header bg-warning text-dark">
                <h4 class="mb-0">
                  <i class="bi bi-megaphone"></i> Anuncios pagados
                </h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Vigencia</th>
                        <th>Texto</th>
                        <th>Costo</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for(anuncio of reporteGanancias.anuncios; track anuncio.id) {
                        <tr>
                          <td>{{ anuncio.id }}</td>
                          <td>
                            <span class="badge bg-primary">{{ anuncio.tipo }}</span>
                          </td>
                          <td>{{ anuncio.vigencia }} días</td>
                          <td>{{ anuncio.texto }}</td>
                          <td class="text-success">${{ anuncio.costo }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }

          <!-- Bloqueos -->
          @if(reporteGanancias.bloqueos && reporteGanancias.bloqueos.length > 0) {
            <div class="card shadow mb-4">
              <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">
                  <i class="bi bi-lock"></i> Bloqueos de anuncios por administradores de cines
                </h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>Administrador de Cine</th>
                        <th>Días de Bloqueo</th>
                        <th>Monto Pagado</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for(bloqueo of reporteGanancias.bloqueos; track $index) {
                        <tr>
                          <td>{{ bloqueo.administradorCine }}</td>
                          <td>
                            <span class="badge bg-danger">{{ bloqueo.dias }} días</span>
                          </td>
                          <td class="text-success">${{ bloqueo.montoPagado }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }

        </div>
      }

    </div>
  </div>
</div>
